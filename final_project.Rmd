---
title: "final_project"
author: "Nicholas Huron"
date: "4/11/2018"
output: html_document
---

```{r setup, include=FALSE}
#clear workspace first
rm(list=ls())

knitr::opts_chunk$set(echo = TRUE)
#set the directory
knitr::opts_knit$set(root.dir = "/Volumes/GoogleDrive/My Drive/Global_Trait/Leiocephalus_Project/")
#For PCs
#knitr::opts_knit$set(root.dir = "G:/My Drive/")

#load required packages
library(tidyverse)
library(ieco)


```

#outline

##Pull and Clean Data

###Morphological Data

```{r pull in morpho dat, message = FALSE}
#read in mean morph dataset
dat.morph <- read_csv("./data/trait/Leiocephalus_sppmean_v4_4.csv", col_names = T)

##does remove scutellation counts
rm.morph <- c("16.1", "22.1", "30", "31", "32", "35", "36", "37", "15.2", "8", "10", "19.2", "19.3", "19.4", "25.2", "25.3", "25.4", "16.1", "19", "22.1", "25", "28", "29", "33", "34")
#rm the new measurements for now
rm.morph <- c(rm.morph, "14.1", "15.1")

#now make the cuts
dat.morph <- dat.morph %>%
  dplyr::select(colnames(dat.morph)[!colnames(dat.morph) %in% rm.morph]) %>%
  as_tibble(.)

#rename the species to drop the genus
#from dat.morph
knitr::kable(
dat.morph <- dat.morph %>%
  mutate(species = str_remove(species, pattern = "Leiocephalus "))
)
```

###IUCN Data
```{r pull in iucn dat, message = FALSE}
#read in iucn shorthand (will need to filter later or join appropriately)
leioiucn <- read_csv(file = "./data/iucn tabular/leiocephalus_IUCN.csv", col_names = T)
#coerce cols to be factors except species

  leioiucn <- leioiucn %>%
  mutate(island_bank = factor(island_bank),
         redlist = factor(redlist),
         notes = factor(notes)
         )

#rename the species to drop the genus
#from leioiucn (also change sci_name variable to species)
knitr::kable(
leioiucn <- leioiucn %>%
  rename(species = sci_name) %>%
  mutate(species = str_remove(species, pattern = "Leiocephalus "))
)
```

###Environmental/Spatial Data

##Turn Morpho Data into PCA
```{r pca}
#log transform data and standardize by SVL
ln.dat.morph <- as.data.frame(log(dat.morph[,-1]))
ln.dat.morph <- cbind(ln.dat.morph[,1], (ln.dat.morph[,-1] / ln.dat.morph[,1]))
colnames(ln.dat.morph)[1] <- "1"


#re-attach the species names
#re-attach the species names
ln.dat.morph <- dat.morph %>%
  select(species) %>%
  bind_cols(., ln.dat.morph)

```


#re-add in IUCN data
dat.morph.ind2 <- right_join(leioiucn, dat.morph.ind2, by = c("species" = "species"))
colnames(dat.morph.ind2)[1] <- "species"


#transform measurements and standardize by SVL
ln.ind.morph <- as.data.frame(log(dat.morph.ind2[,-1:-5]))
ln.ind.morph <- cbind(ln.ind.morph[,1], (ln.ind.morph[,-1] / ln.ind.morph[,1]))
colnames(ln.ind.morph)[1] <- "1"


#re-attach the species names
ln.ind.morph <- dat.morph.ind2 %>%
  select(species:specimen.id.number) %>%
  bind_cols(., ln.ind.morph)






##Plot Datasets